{
  "id": "snapshot_1762522110784_rn5po4t0n",
  "approvalId": "approval_1762522110781_tp6xrgw2u",
  "approvalTitle": "Structure Steering Document (structure.md)",
  "version": 1,
  "timestamp": "2025-11-07T13:28:30.784Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Project Structure\n\n## Directory Organization\n\n```\nevent-checkin/\n├── src/                        # Application source code\n│   ├── app/                    # Next.js App Router (routes & pages)\n│   │   ├── layout.tsx          # Root layout with metadata & fonts\n│   │   └── page.tsx            # Homepage component\n│   ├── server/                 # Server-side code\n│   │   └── db/                 # Database layer\n│   │       ├── index.ts        # Drizzle client initialization\n│   │       └── schema.ts       # Database schema definitions\n│   ├── styles/                 # Global styles\n│   │   └── globals.css         # Tailwind imports & global CSS\n│   └── env.js                  # Environment variable validation\n│\n├── public/                     # Static assets (favicon, images)\n├── .spec-workflow/             # Spec workflow steering & specs\n│   ├── templates/              # Document templates\n│   └── steering/               # Project steering documents\n│\n├── drizzle.config.ts           # Drizzle ORM configuration\n├── next.config.js              # Next.js configuration\n├── tsconfig.json               # TypeScript compiler options\n├── eslint.config.js            # ESLint rules & plugins\n├── prettier.config.js          # Prettier formatting config\n├── postcss.config.js           # PostCSS/Tailwind setup\n├── package.json                # Dependencies & scripts\n└── pnpm-lock.yaml              # Locked dependency versions\n```\n\n## Planned Structure (From README)\n\n```\nsrc/app/\n├── events/\n│   ├── page.tsx                # Event list (Server Component)\n│   ├── new/\n│   │   └── page.tsx            # Create event form (Server Action)\n│   └── [id]/\n│       ├── page.tsx            # Event details\n│       ├── register/\n│       │   └── page.tsx        # Registration form\n│       ├── checkin/\n│       │   └── page.tsx        # Check-in dashboard (Client Component)\n│       └── ticket/\n│           └── [attendeeId]/\n│               └── page.tsx    # QR ticket display\n│\n├── api/\n│   ├── checkin/\n│   │   └── route.ts            # POST: Check-in attendee\n│   └── events/\n│       └── [id]/\n│           └── attendees/\n│               └── route.ts    # GET: List attendees\n│\nsrc/server/db/\n├── schema.ts                   # All database tables (events, attendees)\n└── index.ts                    # Database client\n```\n\n## Naming Conventions\n\n### Files\n- **Pages/Routes**: `page.tsx` for routes, `layout.tsx` for layouts (Next.js convention)\n- **Components**: `PascalCase.tsx` (e.g., `EventCard.tsx`, `QRScanner.tsx`)\n- **API Routes**: `route.ts` in named directories (Next.js App Router convention)\n- **Server Actions**: Colocated with components or in `actions.ts` files\n- **Database**: `schema.ts` for schema, `index.ts` for client initialization\n- **Utilities**: `camelCase.ts` (e.g., `dateUtils.ts`, `qrGenerator.ts`)\n- **Config Files**: `kebab-case.js/ts` (e.g., `next.config.js`, `drizzle.config.ts`)\n\n### Code\n- **React Components**: `PascalCase` function declarations (e.g., `EventList`, `CheckInDashboard`)\n- **Functions/Methods**: `camelCase` (e.g., `createEvent`, `checkInAttendee`)\n- **Types/Interfaces**: `PascalCase` (e.g., `Event`, `Attendee`, `CheckInResponse`)\n- **Constants**: `UPPER_SNAKE_CASE` (e.g., `MAX_ATTENDEES`, `QR_CODE_SIZE`)\n- **Variables**: `camelCase` (e.g., `eventId`, `attendeeList`, `isCheckedIn`)\n- **Database Tables**: Created via `pgTableCreator` with prefix `event-checkin_`\n\n## Import Patterns\n\n### Import Order\n1. External dependencies (React, Next.js, third-party libraries)\n2. Internal absolute imports using `~/` alias (e.g., `~/server/db`, `~/env`)\n3. Relative imports (e.g., `./components`, `../utils`)\n4. Style imports (e.g., `~/styles/globals.css`)\n\n### Path Aliases\n- `~/*` maps to `./src/*` (configured in [tsconfig.json:29-31](tsconfig.json#L29-L31))\n- Examples:\n  - `~/server/db` → `src/server/db`\n  - `~/env` → `src/env.js`\n  - `~/styles/globals.css` → `src/styles/globals.css`\n\n### Module Organization\n```typescript\n// Example component file structure:\nimport { type ReactNode } from \"react\";           // External\nimport { db } from \"~/server/db\";                 // Internal absolute\nimport { EventCard } from \"./EventCard\";          // Relative\nimport \"~/styles/component.css\";                  // Styles\n```\n\n## Code Structure Patterns\n\n### Next.js Component Organization\n```typescript\n// 1. Imports\nimport { type Metadata } from \"next\";\nimport { db } from \"~/server/db\";\n\n// 2. Type definitions\ninterface EventPageProps {\n  params: { id: string };\n}\n\n// 3. Metadata (for pages)\nexport const metadata: Metadata = {\n  title: \"Events\",\n  description: \"Event management\"\n};\n\n// 4. Server Components (data fetching at top level)\nexport default async function EventPage({ params }: EventPageProps) {\n  const event = await db.query.events.findFirst({ /* ... */ });\n\n  return (\n    // JSX\n  );\n}\n\n// 5. Helper functions (below main component)\nfunction formatEventDate(date: Date): string {\n  // ...\n}\n```\n\n### Server Actions Organization\n```typescript\n\"use server\";\n\n// 1. Imports\nimport { revalidatePath } from \"next/cache\";\nimport { db } from \"~/server/db\";\nimport { events } from \"~/server/db/schema\";\n\n// 2. Action functions\nexport async function createEvent(formData: FormData) {\n  // Input validation\n  // Core logic\n  // Database operations\n  // Revalidation/redirect\n}\n```\n\n### Database Schema Organization\n```typescript\n// schema.ts structure:\n// 1. Imports\nimport { pgTableCreator, index } from \"drizzle-orm/pg-core\";\n\n// 2. Table creator\nexport const createTable = pgTableCreator((name) => `event-checkin_${name}`);\n\n// 3. Table definitions (grouped by domain)\nexport const events = createTable(\"event\", /* ... */);\nexport const attendees = createTable(\"attendee\", /* ... */);\n\n// 4. Indexes and relations\n```\n\n## Code Organization Principles\n\n1. **File-based Routing**: Follow Next.js App Router conventions for automatic route creation\n2. **Server-First**: Default to Server Components; mark Client Components with `\"use client\"`\n3. **Colocation**: Keep related files close (components, actions, types in same directory)\n4. **Single Responsibility**: Each file has one primary export/purpose\n5. **Type Safety**: Define explicit TypeScript types for props, API responses, database entities\n\n## Module Boundaries\n\n### Clear Separation of Concerns\n\n- **App Router (`src/app/`)**: UI components, pages, layouts, route handlers\n  - Server Components for data fetching and static rendering\n  - Client Components for interactivity (marked with `\"use client\"`)\n  - Server Actions for mutations (colocated or separate `actions.ts` files)\n\n- **Server Logic (`src/server/`)**: Backend-only code (database, business logic)\n  - Never imported by Client Components\n  - Database access layer isolated\n  - Server-only utilities\n\n- **Database Layer (`src/server/db/`)**: Data persistence\n  - Schema definitions are source of truth\n  - Single database client instance (with HMR caching)\n  - Migrations managed via Drizzle Kit\n\n- **Shared Types**: TypeScript types can be shared across client/server boundaries\n  - Infer types from Drizzle schema: `typeof events.$inferSelect`\n  - Define explicit API response types\n\n### Dependency Direction\n```\nClient Components → Server Components → Server Actions → Database Layer\n     ↓                                                         ↑\n  (cannot import server code directly)              (can use in Server Components)\n```\n\n## Code Size Guidelines\n\n- **File Size**: Prefer <300 lines per file; split larger components into sub-components\n- **Function/Method Size**: Keep functions focused, aim for <50 lines\n- **Component Complexity**: Break down complex components into smaller, reusable pieces\n- **Nesting Depth**: Limit to 3-4 levels; extract nested logic into helper functions\n- **Server Components**: Keep data fetching separate from presentation when possible\n\n## TypeScript Configuration\n\n### Strict Type Safety\n- Strict mode enabled ([tsconfig.json:14](tsconfig.json#L14))\n- `noUncheckedIndexedAccess: true` prevents undefined array access\n- Type-checked imports preferred with inline syntax\n- ESLint enforces type imports: `import { type Foo } from \"...\"`\n\n### ESLint Rules (Key Patterns)\n- Inline type imports: `import { type Metadata } from \"next\"`\n- Unused vars starting with `_` are allowed (useful for unused function params)\n- Drizzle safety: Enforce `where` clause on delete/update operations\n- TypeScript stylistic and recommended rules enabled\n\n### Prettier Formatting\n- Tailwind class sorting via `prettier-plugin-tailwindcss`\n- Automatic formatting on save (recommended)\n- Consistent code style across team\n\n## Documentation Standards\n\n- **Public Components**: Add JSDoc comments for exported components with props descriptions\n- **Complex Logic**: Inline comments explaining business rules (especially QR validation, check-in logic)\n- **README Files**: Each major feature directory should have a README explaining its purpose\n- **Database Schema**: Comment fields with business context (e.g., check-in timestamp significance)\n- **API Routes**: Document request/response formats with TypeScript types\n\n### Example Documentation\n```typescript\n/**\n * Checks in an attendee using their unique QR code.\n * Prevents duplicate check-ins by validating checkedInAt timestamp.\n *\n * @param attendeeId - Unique identifier from QR code\n * @returns Check-in success status and attendee details\n * @throws Error if attendee not found or already checked in\n */\nexport async function checkInAttendee(attendeeId: string) {\n  // ...\n}\n```\n\n## Environment & Configuration\n\n- **Environment Variables**: Validated via `@t3-oss/env-nextjs` in [src/env.js](src/env.js)\n  - Server vars: `DATABASE_URL`, `NODE_ENV`\n  - Client vars: Prefix with `NEXT_PUBLIC_`\n  - Build fails if required vars missing or invalid\n\n- **Configuration Files**:\n  - [next.config.js](next.config.js): Next.js settings (minimal by default)\n  - [drizzle.config.ts](drizzle.config.ts): Database connection and schema path\n  - [tsconfig.json](tsconfig.json): TypeScript compiler options and path aliases\n  - [eslint.config.js](eslint.config.js): Linting rules with Drizzle plugin\n  - [prettier.config.js](prettier.config.js): Code formatting with Tailwind plugin\n\n## Development Workflow\n\n1. **Start Development**: `pnpm dev` (Turbopack for fast HMR)\n2. **Type Check**: `pnpm typecheck` (runs `tsc --noEmit`)\n3. **Lint**: `pnpm lint` or `pnpm lint:fix`\n4. **Format**: `pnpm format:check` or `pnpm format:write`\n5. **Database**:\n   - Schema changes: Edit `schema.ts` → `pnpm db:generate` → `pnpm db:migrate`\n   - Quick push: `pnpm db:push` (development only)\n   - Visual editor: `pnpm db:studio`\n6. **Build**: `pnpm build` (validates types, lints, and builds for production)\n",
  "fileStats": {
    "size": 11121,
    "lines": 289,
    "lastModified": "2025-11-07T13:28:22.621Z"
  },
  "comments": []
}